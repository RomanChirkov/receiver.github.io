/*!
 * Anvato Chromecast Receiver Framework v3
 * partner.js
 * Copyright 2022-2023
 */

var timers={};var adBreaks;var totalAdDuration=0;var currentContentDuration;var currentZoneIndex;var currentContentType;var zones=[];var log=typeof logger!="undefined"?logger.getLogFn("APP"):function(){console.log.apply(console,["[!APP!]\t"].concat(Array.prototype.slice.call(arguments)))};var util=Util();var mediator;var recommendationContainer;var currentRecommendations;var currentRecommendationsOwner;var recom;if(typeof anvr=="undefined"){anvr={}}anvr.config={debug:true,videoPlaceholderId:"video-placeholder",customNamespaces:["urn:x-cast:com.partner.chromecast"],controls:true};console.log("partner.js anvr: ",anvr);anvr.onReady=function(){log("@onReady",JSON.stringify(arguments,null,3));var e=anvr.getCustomMessageBus("urn:x-cast:com.partner.chromecast");util=Util();mediator=new Mediator;mediator.subscribe("recommendationsReady",function(){log("@subs~recommendationsReady")});mediator.subscribe("recommendationSelected",function(e){log("@subs~recommendationSelected",JSON.stringify(e,null,3));anvr.loadRecommendation(currentRecommendationsOwner,e);recom.hide()});recommendationContainer=document.getElementById("recommendations");recom=new Recommendation(mediator,recommendationContainer,null);recom.init();anvr.setPartnerData("test","OK")};anvr.onCustomMessage=function(e,t,n){log("@onCustomMessage",JSON.stringify(arguments,null,3));anvr.sendCustomMessage(e,t,n)};anvr.onStateChanged=function(e){log("@onStateChanged",JSON.stringify(arguments,null,3));var t=document.getElementById("debug-state");var n={idle:1,verified:1};t.innerHTML=e;setTimeout(asyncTransition.bind(null,e),e in n?800:100)};anvr.listener=function(e){log("@listener",JSON.stringify(e,null,3));var t;var n=document.getElementById("player");var r=n.querySelector(".media-title");var a=n.querySelector(".media-subtitle");var o=n.querySelector(".media-artwork");var i="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";var s;switch(e.name){case"RECEIVER_TYPE_SET":s=e.args[0]=="live";n.setAttribute("live",s.toString());break;case"METADATA_LOADED":zones=[];adBreaks=[];resetMarkers();totalAdDuration=0;currentZoneIndex=undefined;currentRecommendations=undefined;currentRecommendationsOwner=undefined;hidePlaylistNotification();t=e.args[2];currentContentDuration=t.duration;o.src=t.thumbnail||i;case"PROGRAM_CHANGED":t=e.args[2];r.innerHTML=t.title||"";a.innerHTML=t.description||"";break;case"SEEK_STARTED":clearTimeout(timers.seekingTimeoutId);if(currentContentType!="ad"){n.classList.add("seeking")}break;case"SEEK_ENDED":clearTimeout(timers.seekingTimeoutId);if(currentContentType=="ad"){n.classList.remove("seeking")}else{timers.seekingTimeoutId=addClassWithTimeout(n,"seeking",100)}break;case"AD_BREAKS":adBreaks=e.args[0];populateMarkers();break;case"RECOMMENDATIONS_AVAILABLE":currentRecommendations=e.args[0];currentRecommendationsOwner=e.args[1];recom.setRecommendations(currentRecommendations.items,currentRecommendations.duration||15);break;case"RECOMMENDATION_SELECTED":recom.clearTimer();recom.hide();break;case"NEXT_VIDEO":populatePlaylistNotification(e.name,e.args[0],e.args[1]);break;case"CAPTION_STATUS":console.log("pizdec",e,e.name,e.args[0],e.args[1],e,t);break}};function populatePlaylistNotification(e,t,n){var r=document.getElementById("playlist-notification-text");r.innerHTML=e;var a=document.getElementById("playlist-notification-title");var o=document.getElementById("playlist-notification-thumbnail");a.innerHTML=t.title;o.src=t.src_image_url;countDown(n,"Up next in {{DURATION}} seconds",/\{\{DURATION\}\}/,r,hidePlaylistNotification);getElementByClass(".playlist-notification").setAttribute("toggle","on")}function hidePlaylistNotification(){getElementByClass(".playlist-notification").setAttribute("toggle","off")}function countDown(e,t,n,r,a){r.innerHTML=t.replace(n,e.toString());if(e>1){setTimeout(function(){countDown(--e,t,n,r,a)},1e3)}else{a()}}function resetMarkers(){log("@resetMarkers");var e=document.getElementById("player");e.removeAttribute("mode");var t=getElementByClass(".controls-progress");var n=t.getElementsByClassName("controls-ad-break");n=Array.prototype.slice.call(n);while(n.length){t.removeChild(n.shift())}}function populateMarkers(){log("@populateMarkers");var e,t=0;var n=getElementByClass(".controls-progress");var r,a;for(var o=0,i=adBreaks.length;o<i;o++){e=adBreaks[o];r=document.createElement("div");r.className="controls-ad-break";a=(e.start-t)*100/currentContentDuration+"%";r.style.left=a;log("@populateMarkers markerLeft",a);n.appendChild(r);t+=e.end-e.start}}anvr.onTimeUpdated=function(e,t,n,r,a){var o,i;o=document.getElementById("player");o.setAttribute("mode",n);currentContentType=n;if(n=="ad"&&adBreaks&&adBreaks.length){i=parseInt(adBreaks[r].end-adBreaks[r].start-e);getElementByClass(".ad-remaining").innerHTML=i?"Your video will resume in "+i+" second"+(i>1?"s":""):""}var s=getElementByClass(".controls-progress-inner"),l=getElementByClass(".controls-progress-thumb"),c=getElementByClass(".controls-cur-time"),m=getElementByClass(".controls-total-time");if(!isNaN(e)&&!isNaN(t)){var d=100*(e/t);c.innerText=formatDuration(e);m.innerText=formatDuration(t);s.style.width=d+"%";l.style.left=d+"%"}};function asyncTransition(e){var t=document.getElementById("player");t.setAttribute("state",e);if(e=="idle"||e=="done"){t.removeAttribute("mode")}if(e=="recommendations"&&currentRecommendations){recom.startTimer();recom.show()}anvr.onStateTransitionCompleted()}function addClassWithTimeout(e,t,n){e.classList.add(t);return setTimeout(function(){e.classList.remove(t)},n)}function getElementByClass(e){var t=document.getElementById("player").querySelector(e);if(t){return t}else{throw Error("Cannot find mediaElement with class: "+e)}}function formatDuration(e){e=Math.floor(e);function t(e){return("00"+Math.round(e)).slice(-2)}var n=Math.floor(e/3600);var r=Math.floor(e/60)%60;var a=e%60;if(!n){return t(r)+":"+t(a)}else{return t(n)+":"+t(r)+":"+t(a)}}anvr.init();