/*!
 * Anvato Chromecast Receiver Framework v3
 * Recommendation.js
 * Copyright 2022-2023
 */

function Recommendation(t,i,e){var f={},g=[],p=e?e.getLogFn("Recommendation"):function(){console.log.apply(console,["[!Recommendation!]\t"].concat(Array.prototype.slice.call(arguments)))},n=0,o=false,a=false,v={},y="http://qa.up.anv.bz/dev/img/defaultthumbnail.png",l={},r=10;function c(){f.content=util.generateChild(i,"div","content","recommendation-content");f.header=util.generateChild(f.content,"div","header","recommendation-header");f.title=util.generateChild(f.header,"div","title","recommendation-title");f.share=util.generateChild(f.header,"div","share","recommendation-share");f.replay=util.generateChild(f.header,"div","replay","recommendation-replay");f.main=util.generateChild(f.content,"div","main","recommendation-main");f.columns=util.generateChild(f.main,"div","columns","recommendation-columns");util.addEventListener(f.columns,"click",d,false);util.addEventListener(f.replay,"click",function(){i.style.visibility="hidden";t.publish("playRequest")});util.addEventListener(f.share,"click",function(){i.style.visibility="hidden";t.publish("toggleSharePanel")})}function d(e){var i,t,n;if(e.target!=this){p("OK");i=e.target.parentNode;t=e.target;while(i.parentNode!=this){t=i;i=i.parentNode}p(t.className);n=/frame([0-9]+)/.exec(t.id);p("selected",n[1]);s(parseInt(n[1]))}}function s(e){t.publish("recommendationSelected",g[e])}function u(e){n++;p("poster:",e.width,"X",e.height,e.src);v[util.base64Encode(e.src)]={};v[util.base64Encode(e.src)].w=e.width;v[util.base64Encode(e.src)].h=e.height;if(n>=Math.min(g.length,6)){b();a=true;t.publish("recommendationsReady")}}function m(e){v[util.base64Encode(e.src)]={};v[util.base64Encode(e.src)].error=true;u(e)}function h(){var e,i=Math.min(g.length,6),t=[];for(e=0;e<i;e++){t.push(g[e].image)}util.cacheImages(t,u,m)}function b(){var e,i=Math.ceil(g.length/2),t=Math.ceil(i/3),n=f.main.clientWidth/3;f.columns.style.width=t*100+"%";p(t*100+"%");for(e=0;e<i;e++){M(e,n)}}function w(e){if(e){f.countDownNode.innerHTML="Playing in "+Math.abs(e)+" second"+(Math.abs(e)>1?"s":"");f.countDownNode.style.display="block";f.countDownNode.parentNode.style.display="block";if(e>0){l.countDown=setTimeout(function(){w(--e)},1e3)}}else{f.countDownNode.style.display="none";f.countDownNode.parentNode.style.display="";t.publish("recommendationSelected",g[0])}}function C(e,i){if(i<g.length){var t=util.generateChild(e,"div","frame"+i,"recommendation-frame");var n=util.generateChild(t,"div","item"+i,"recommendation-item");var o=util.generateChild(n,"img","item"+i,"recommendation-thumbnail");var a=v[util.base64Encode(g[i].image)].w;var l=v[util.base64Encode(g[i].image)].h;p("#poster:",a,"X",l);if(!v[util.base64Encode(g[i].image)].error){o.src=g[i].image}else{o.src=y}var r=f.main.clientWidth*.95*3/16;var c=r*16/9;n.style.height=r+"px";if(l*c/a<=r){o.width=c-3}else{o.height=r-1}var d=util.generateChild(n,"div","info"+i,"recommendation-info");var s=util.generateChild(d,"p","title"+i,"recommendation-info-title");var u=util.generateChild(d,"p","desc"+i,"recommendation-info-desc");if(!i){f.countDownNode=util.generateChild(d,"p","timer","recommendation-info-timer")}var m=parseInt(g[i].duration);var h=g[i].description||"";d.style.height=r+"px";s.innerHTML=g[i].title;u.innerHTML=m?util.sec2TimeString(parseInt(g[i].duration)):h;return{item:n,info:d,title:s,detail:u.innerHTML}}}function M(e,i){var t=util.generateChild(f.columns,"div","column"+e,"recommendation-column");t.style.width=i+"px";C(t,2*e);C(t,2*e+1);p("column",e," generated")}function N(){f.columns.innerHTML=""}function E(e){for(var i=0,t=1,n;1;i+=t,t/=2){if(e>=(7-4*i)/11){return-Math.pow((11-6*i-11*e)/4,2)+Math.pow(t,2)}}}function T(i){return function(e){return 1-i(1-e)}}return{init:function(){p("@init");c()},setRecommendations:function(e,i){p("@setRecommendations");g=e;n=0;r=i;a=false;N();h();t.publish("loadingRecommendations")},show:function(e){p("@show");if(e)f.title.innerHTML=e;if(!a)t.publish("loadingRecommendations");i.style.visibility="visible";o=true},hide:function(){p("@hide");i.style.visibility="hidden";o=false},startTimer:function(){w(r)},clearTimer:function(){clearTimeout(l.countDown)}}}